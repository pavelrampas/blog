const apiUrl="https://blog.pavelrampas.cz",apiAuth="d58e3582afa99040e27b92b13c8f2280",commentsDiv=document.getElementById("comments");commentsDiv&&loadComments();const articleMetaElements=document.querySelectorAll(".article-meta[data-article-id]");function loadCommentsCount(e){let t=[];e.forEach(e=>{t.push(e.dataset.articleId)}),fetch(apiUrl+"/api/v1/comments-count/?"+t.map(e=>`ids[]=${e}`).join("&"),{method:"GET",headers:{Authorization:apiAuth},credentials:"include"}).then(e=>e.json()).then(t=>{if(t.errors){alert(t.errors[0].detail);return}t.data.length>0&&e.forEach(e=>{for(let n of t.data)if(parseInt(n.id)===parseInt(e.dataset.articleId)){let a=e.closest("article").getElementsByTagName("h2")[0].getElementsByTagName("a")[0].href,m=document.createElement("span");m.className="article-meta-separator",m.textContent=" | ",e.appendChild(m);let o=document.createElement("span");o.className="article-meta-comments-count",o.innerHTML='<a href="'+a+'#comments">'+formatCommentCount(n.attributes.count)+"</a>",e.appendChild(o);break}})}).catch(e=>console.error("Error loading comments count:",e))}function loadComments(){fetch(apiRequestUrl(),{method:"GET",headers:{Authorization:apiAuth},credentials:"include"}).then(e=>e.json()).then(e=>{let t=document.getElementById("comments");if(t&&t.classList.remove("hide"),!t){console.error("Comments section not found.");return}if(t.innerHTML='<h3>Komentáře</h3><div id="comment-list"><p>Zatím tu není žádný komentář.</p></div><form action="" method="post" id="comment-form"><h3>Nový komentář</h3><div class="form-group"><label for="name">Jméno*</label><br><input type="text" id="name" name="name" required></div><div class="form-group"><label for="email">E-mail* (nebude zveřejněn)</label><br><input type="email" id="email" name="email" required></div><div class="form-group"><label for="comment">Komentář*</label><br><textarea id="comment" name="comment" rows="4" required></textarea></div><input type="hidden" name="post-id" id="post-id" value="1000"><input type="hidden" name="email-check" id="email-check" value=""><input type="hidden" name="time-check" id="time-check" value="'+new Date().getTime()+'"><div class="form-group"><button type="submit">Odeslat komentář</button></div></form>',addCommentEventListener(),e.errors){alert(e.errors[0].detail);return}if(e.data.length>0){let n=document.getElementById("comment-list");for(let a of(n.innerHTML="",e.data)){let m=createCommentElement(a);n.appendChild(m)}}}).catch(e=>console.error("Error loading comments:",e))}function addComment(){let e=document.getElementById("comment").value.trim(),t=document.getElementById("name").value.trim(),n=document.getElementById("email").value.trim(),a=document.getElementById("email-check").value.trim(),m=document.getElementById("time-check").value.trim();if(""!==a){alert("Antispamová kontrola selhala. Zkuste to prosím znovu.");return}let o=new Date().getTime();if(o-parseInt(m)<5e3){alert("Antispamová kontrola selhala. Zkuste to prosím znovu.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){alert("Zadejte prosím platnou e-mailovou adresu.");return}if(e.length<5||e.length>500){alert("Komentář musí mít alespoň 5 znaků a maximálně 500 znaků.");return}if(t.length<3||t.length>50){alert("Jméno musí mít alespoň 3 znaky a maximálně 50 znaků.");return}fetch(apiRequestUrl(),{method:"POST",headers:{"Content-Type":"application/json",Authorization:apiAuth},credentials:"include",body:JSON.stringify({comment:e,name:t,email:n,email_check:a,time_check:m})}).then(e=>e.json()).then(e=>{if(e.errors){alert(e.errors[0].detail);return}document.getElementById("comment").value="",document.getElementById("name").value="",document.getElementById("email").value="";let t=document.getElementById("comment-list"),n=createCommentElement(e.data[0]);t.appendChild(n)}).catch(e=>console.error("Error adding comment:",e))}function addCommentEventListener(){document.getElementById("comment-form").addEventListener("submit",function(e){e.preventDefault();let t=this.querySelector('button[type="submit"]');t.disabled=!0,t.textContent="Odesílání...",addComment(),t.disabled=!1,t.textContent="Odeslat komentář"})}function apiRequestUrl(){let e=document.getElementById("comments");return apiUrl+"/api/v1/comments/index.php?article="+e.dataset.articleId}function createCommentElement(e){let t=document.createElement("div");return t.className="comment",t.id="comment-"+e.id,t.innerHTML='<p class="comment-name"><strong>'+e.attributes.name+'</strong><a href="#comment-'+e.id+'" class="comment-date">'+new Date(e.attributes.created).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",hour12:!1,minute:"2-digit"})+"</a></p><p>"+e.attributes.comment+"</p>",t}function formatCommentCount(e){return 0===e?"0 komentářů":1===e?"1 komentář":2===e||3===e||4===e?e+" komentáře":e+" komentářů"}articleMetaElements.length>0&&loadCommentsCount(articleMetaElements);